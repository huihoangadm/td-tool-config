(async function(){
  // Protected loader v1
  const configUrl = "https://raw.githubusercontent.com/huihoangadm/td-tool-config/refs/heads/main/config.json";
  try{
    const resp = await fetch(configUrl, {cache: "no-store"});
    if (!resp.ok) throw new Error("Không lấy được config");
    const cfg = await resp.json();
    if (!cfg || !cfg.password) throw new Error("Config không hợp lệ");
    const userPwd = prompt("Nhập mật khẩu để chạy tool:");
    if (userPwd === null) { console.log("User canceled"); return; }
    if (userPwd !== cfg.password) { alert("Sai mật khẩu — tool dừng"); return; }
    // mật khẩu đúng -> decode và chạy code
    const codeB64 = "KCgpID0+IHsKICBpZiAod2luZG93LlREX0FVVE9fTE9BREVEKSB7CiAgICBjb25zb2xlLmxvZygiQXV0byBib3QgxJHDoyDEkcaw4bujYyBsb2FkIHLhu5NpLiIpOwogICAgcmV0dXJuOwogIH0KICB3aW5kb3cuVERfQVVUT19MT0FERUQgPSB0cnVlOwoKICAvKiAtLS0tLS0tLS0tIENPTkZJRyAtLS0tLS0tLS0tICovCiAgY29uc3QgVElMRV9QWCA9IDE0NzsgLy8gdGhlbyBmaWxlIGhlYWRlci5qcwogIGNvbnN0IEdSSURfU0laRSA9IDQ7CiAgY29uc3QgU0VBUkNIX0RFUFRIID0gMzsgLy8gRXhwZWN0aW1heCBkZXB0aCAoMyA9IG3huqFuaCwgMiA9IG5oYW5oKQogIGNvbnN0IE1PVkVfSU5URVJWQUxfTVMgPSAxMjA7IC8vIHRo4budaSBnaWFuIGdp4buvYSBjw6FjIG1vdmUgZ+G7rWkgcGjDrW0KICBjb25zdCBMT0cgPSBmYWxzZTsKCiAgLyogLS0tLS0tLS0tLSBVVElMOiDEkeG7jWMgYm9hcmQgdOG7qyBET00gLS0tLS0tLS0tLSAqLwogIGZ1bmN0aW9uIHJlYWRCb2FyZEZyb21ET00oKSB7CiAgICBjb25zdCBib2FyZCA9IEFycmF5LmZyb20oeyBsZW5ndGg6IEdSSURfU0laRSB9LCAoKSA9PgogICAgICBBcnJheShHUklEX1NJWkUpLmZpbGwobnVsbCkKICAgICk7CiAgICBjb25zdCB0aWxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5ncmlkIC50aWxlIik7CiAgICB0aWxlcy5mb3JFYWNoKCh0KSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVjdExlZnQgPSB0LnN0eWxlLmxlZnQgfHwgd2luZG93LmdldENvbXB1dGVkU3R5bGUodCkubGVmdDsKICAgICAgICBjb25zdCByZWN0VG9wID0gdC5zdHlsZS50b3AgfHwgd2luZG93LmdldENvbXB1dGVkU3R5bGUodCkudG9wOwogICAgICAgIGNvbnN0IGxlZnQgPSBwYXJzZUZsb2F0KHJlY3RMZWZ0LnJlcGxhY2UoInB4IiwgIiIpKSB8fCAwOwogICAgICAgIGNvbnN0IHRvcCA9IHBhcnNlRmxvYXQocmVjdFRvcC5yZXBsYWNlKCJweCIsICIiKSkgfHwgMDsKICAgICAgICBjb25zdCBjID0gTWF0aC5yb3VuZChsZWZ0IC8gVElMRV9QWCk7CiAgICAgICAgY29uc3QgciA9IE1hdGgucm91bmQodG9wIC8gVElMRV9QWCk7CiAgICAgICAgY29uc3QgdmFsVGV4dCA9IHQudGV4dENvbnRlbnQudHJpbSgpOwogICAgICAgIGNvbnN0IHZhbCA9IHBhcnNlSW50KHZhbFRleHQsIDEwKTsKICAgICAgICBpZiAoIWlzTmFOKHZhbCkgJiYgciA+PSAwICYmIHIgPCBHUklEX1NJWkUgJiYgYyA+PSAwICYmIGMgPCBHUklEX1NJWkUpIHsKICAgICAgICAgIGJvYXJkW3JdW2NdID0gdmFsOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vIGlnbm9yZQogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBib2FyZDsKICB9CgogIC8qIC0tLS0tLS0tLS0gU0lNVUxBVElPTjogc2xpZGUgKyBtb3ZlIHRyw6puIGJvYXJkIGNvcHkgLS0tLS0tLS0tLSAqLwogIGZ1bmN0aW9uIGNsb25lQm9hcmQoYikgewogICAgcmV0dXJuIGIubWFwKChyKSA9PiByLnNsaWNlKCkpOwogIH0KCiAgZnVuY3Rpb24gc2xpZGVSb3dWYWx1ZXMocm93VmFscykgewogICAgLy8gcm93VmFsczogYXJyYXkgbGVuZ3RoIEdSSURfU0laRSB3aXRoIG51bWJlcnMgb3IgbnVsbAogICAgY29uc3QgYXJyID0gcm93VmFscy5maWx0ZXIoKHgpID0+IHggIT09IG51bGwpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoIC0gMTsgaSsrKSB7CiAgICAgIGlmIChhcnJbaV0gPT09IGFycltpICsgMV0pIHsKICAgICAgICBhcnJbaV0gPSBhcnJbaV0gKiAyOwogICAgICAgIGFyci5zcGxpY2UoaSArIDEsIDEpOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAoYXJyLmxlbmd0aCA8IEdSSURfU0laRSkgYXJyLnB1c2gobnVsbCk7CiAgICByZXR1cm4gYXJyOwogIH0KCiAgZnVuY3Rpb24gbW92ZU9uKGJvYXJkLCBkaXIpIHsKICAgIC8vIHJldHVybiB7Ym9hcmQ6IG5ld0JvYXJkLCBtb3ZlZDogYm9vbH0KICAgIGNvbnN0IG5ld0IgPSBjbG9uZUJvYXJkKGJvYXJkKTsKICAgIGxldCBtb3ZlZCA9IGZhbHNlOwoKICAgIGlmIChkaXIgPT09ICJsZWZ0IiB8fCBkaXIgPT09ICJyaWdodCIpIHsKICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBHUklEX1NJWkU7IHIrKykgewogICAgICAgIGxldCByb3cgPSBuZXdCW3JdLnNsaWNlKCk7CiAgICAgICAgaWYgKGRpciA9PT0gInJpZ2h0Iikgcm93ID0gcm93LnNsaWNlKCkucmV2ZXJzZSgpOwogICAgICAgIGNvbnN0IG5ld1JvdyA9IHNsaWRlUm93VmFsdWVzKHJvdyk7CiAgICAgICAgY29uc3QgZmluYWxSb3cgPSBkaXIgPT09ICJyaWdodCIgPyBuZXdSb3cuc2xpY2UoKS5yZXZlcnNlKCkgOiBuZXdSb3c7CiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBHUklEX1NJWkU7IGMrKykgewogICAgICAgICAgaWYgKG5ld0Jbcl1bY10gIT09IGZpbmFsUm93W2NdKSBtb3ZlZCA9IHRydWU7CiAgICAgICAgICBuZXdCW3JdW2NdID0gZmluYWxSb3dbY107CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGxldCBjID0gMDsgYyA8IEdSSURfU0laRTsgYysrKSB7CiAgICAgICAgbGV0IGNvbCA9IFtdOwogICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgR1JJRF9TSVpFOyByKyspIGNvbC5wdXNoKG5ld0Jbcl1bY10pOwogICAgICAgIGlmIChkaXIgPT09ICJkb3duIikgY29sID0gY29sLnNsaWNlKCkucmV2ZXJzZSgpOwogICAgICAgIGNvbnN0IG5ld0NvbCA9IHNsaWRlUm93VmFsdWVzKGNvbCk7CiAgICAgICAgY29uc3QgZmluYWxDb2wgPSBkaXIgPT09ICJkb3duIiA/IG5ld0NvbC5zbGljZSgpLnJldmVyc2UoKSA6IG5ld0NvbDsKICAgICAgICBmb3IgKGxldCByID0gMDsgciA8IEdSSURfU0laRTsgcisrKSB7CiAgICAgICAgICBpZiAobmV3QltyXVtjXSAhPT0gZmluYWxDb2xbcl0pIG1vdmVkID0gdHJ1ZTsKICAgICAgICAgIG5ld0Jbcl1bY10gPSBmaW5hbENvbFtyXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4geyBib2FyZDogbmV3QiwgbW92ZWQgfTsKICB9CgogIC8qIC0tLS0tLS0tLS0gRVZBTFVBVElPTiBIRVVSSVNUSUMgLS0tLS0tLS0tLSAqLwogIGZ1bmN0aW9uIGhldXJpc3RpYyhib2FyZCkgewogICAgLy8gY29tYmluZSBlbXB0aWVzLCBtb25vdG9uaWNpdHksIG1heCB0aWxlCiAgICBsZXQgZW1wdGllcyA9IDA7CiAgICBsZXQgbWF4VGlsZSA9IDA7CiAgICBmb3IgKGxldCByID0gMDsgciA8IEdSSURfU0laRTsgcisrKSB7CiAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgR1JJRF9TSVpFOyBjKyspIHsKICAgICAgICBjb25zdCB2ID0gYm9hcmRbcl1bY107CiAgICAgICAgaWYgKCF2KSBlbXB0aWVzKys7CiAgICAgICAgZWxzZSBpZiAodiA+IG1heFRpbGUpIG1heFRpbGUgPSB2OwogICAgICB9CiAgICB9CgogICAgLy8gbW9ub3RvbmljaXR5IChyb3dzICsgY29scykKICAgIGZ1bmN0aW9uIG1vbm90b25pY2l0eVNjb3JlKGIpIHsKICAgICAgbGV0IHNjb3JlID0gMDsKICAgICAgLy8gcm93cwogICAgICBmb3IgKGxldCByID0gMDsgciA8IEdSSURfU0laRTsgcisrKSB7CiAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBHUklEX1NJWkUgLSAxOyBjKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSBiW3JdW2NdIHx8IDA7CiAgICAgICAgICBjb25zdCBiMiA9IGJbcl1bYyArIDFdIHx8IDA7CiAgICAgICAgICBpZiAoYSA+PSBiMikgc2NvcmUgKz0gTWF0aC5sb2cyKGEgKyAxKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gY29scwogICAgICBmb3IgKGxldCBjID0gMDsgYyA8IEdSSURfU0laRTsgYysrKSB7CiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBHUklEX1NJWkUgLSAxOyByKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSBiW3JdW2NdIHx8IDA7CiAgICAgICAgICBjb25zdCBiMiA9IGJbciArIDFdW2NdIHx8IDA7CiAgICAgICAgICBpZiAoYSA+PSBiMikgc2NvcmUgKz0gTWF0aC5sb2cyKGEgKyAxKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHNjb3JlOwogICAgfQogICAgY29uc3QgbW9ubyA9IG1vbm90b25pY2l0eVNjb3JlKGJvYXJkKTsKCiAgICAvLyBzbW9vdGhuZXNzOiBwZW5hbGl6ZSBsYXJnZSBkaWZmZXJlbmNlcyBiZXR3ZWVuIG5laWdoYm9ycwogICAgbGV0IHNtb290aCA9IDA7CiAgICBmb3IgKGxldCByID0gMDsgciA8IEdSSURfU0laRTsgcisrKSB7CiAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgR1JJRF9TSVpFOyBjKyspIHsKICAgICAgICBjb25zdCB2ID0gYm9hcmRbcl1bY107CiAgICAgICAgaWYgKCF2KSBjb250aW51ZTsKICAgICAgICBjb25zdCB2bG9nID0gTWF0aC5sb2cyKHYpOwogICAgICAgIGNvbnN0IG5zID0gWwogICAgICAgICAgW3IgKyAxLCBjXSwKICAgICAgICAgIFtyLCBjICsgMV0KICAgICAgICBdOwogICAgICAgIG5zLmZvckVhY2goKFtuciwgbmNdKSA9PiB7CiAgICAgICAgICBpZiAobnIgPCBHUklEX1NJWkUgJiYgbmMgPCBHUklEX1NJWkUpIHsKICAgICAgICAgICAgY29uc3QgbnYgPSBib2FyZFtucl1bbmNdOwogICAgICAgICAgICBpZiAobnYpIHNtb290aCAtPSBNYXRoLmFicyhNYXRoLmxvZzIobnYpIC0gdmxvZyk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBmaW5hbCB3ZWlnaHRlZCBzdW0KICAgIHJldHVybiBlbXB0aWVzICogMTAwMCArIG1vbm8gKiAxMCArIG1heFRpbGUgKiAxICsgc21vb3RoICogNTsKICB9CgogIC8qIC0tLS0tLS0tLS0gRXhwZWN0aW1heCBpbXBsZW1lbnRhdGlvbiAtLS0tLS0tLS0tICovCiAgY29uc3QgTU9WRVMgPSBbInVwIiwgInJpZ2h0IiwgImRvd24iLCAibGVmdCJdOwogIGZ1bmN0aW9uIGdldEVtcHR5Q2VsbHMoYm9hcmQpIHsKICAgIGNvbnN0IGVtcHRpZXMgPSBbXTsKICAgIGZvciAobGV0IHIgPSAwOyByIDwgR1JJRF9TSVpFOyByKyspIHsKICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBHUklEX1NJWkU7IGMrKykgewogICAgICAgIGlmICghYm9hcmRbcl1bY10pIGVtcHRpZXMucHVzaChbciwgY10pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZW1wdGllczsKICB9CgogIGZ1bmN0aW9uIGV4cGVjdGltYXgoYm9hcmQsIGRlcHRoLCBpc0NoYW5jZSkgewogICAgLy8gY3V0b2ZmCiAgICBjb25zdCBlbXB0aWVzID0gZ2V0RW1wdHlDZWxscyhib2FyZCk7CiAgICBpZiAoZGVwdGggPT09IDAgfHwgZW1wdGllcy5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIGhldXJpc3RpYyhib2FyZCk7CiAgICB9CgogICAgaWYgKGlzQ2hhbmNlKSB7CiAgICAgIC8vIGNoYW5jZSBub2RlOiBzcGF3biAyICgwLjkpIG9yIDQgKDAuMSkgb24gZWFjaCBlbXB0eSBjZWxsLCBjb21wdXRlIGV4cGVjdGVkIHZhbHVlCiAgICAgIGxldCB0b3RhbCA9IDA7CiAgICAgIGNvbnN0IGVtcHQgPSBlbXB0aWVzOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVtcHQubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBbciwgY10gPSBlbXB0W2ldOwogICAgICAgIC8vIHNwYXduIDIKICAgICAgICBjb25zdCBiMiA9IGNsb25lQm9hcmQoYm9hcmQpOwogICAgICAgIGIyW3JdW2NdID0gMjsKICAgICAgICBjb25zdCB2MiA9IGV4cGVjdGltYXgoYjIsIGRlcHRoIC0gMSwgZmFsc2UpOwogICAgICAgIC8vIHNwYXduIDQKICAgICAgICBjb25zdCBiNCA9IGNsb25lQm9hcmQoYm9hcmQpOwogICAgICAgIGI0W3JdW2NdID0gNDsKICAgICAgICBjb25zdCB2NCA9IGV4cGVjdGltYXgoYjQsIGRlcHRoIC0gMSwgZmFsc2UpOwogICAgICAgIGNvbnN0IGV2ID0gMC45ICogdjIgKyAwLjEgKiB2NDsKICAgICAgICB0b3RhbCArPSBldjsKICAgICAgfQogICAgICByZXR1cm4gdG90YWwgLyBlbXB0Lmxlbmd0aDsKICAgIH0gZWxzZSB7CiAgICAgIC8vIG1heCBub2RlOiBjaG9vc2UgYmVzdCBtb3ZlCiAgICAgIGxldCBiZXN0ID0gLUluZmluaXR5OwogICAgICBmb3IgKGxldCBtID0gMDsgbSA8IE1PVkVTLmxlbmd0aDsgbSsrKSB7CiAgICAgICAgY29uc3QgbXYgPSBNT1ZFU1ttXTsKICAgICAgICBjb25zdCB7IGJvYXJkOiBuYiwgbW92ZWQgfSA9IG1vdmVPbihib2FyZCwgbXYpOwogICAgICAgIGlmICghbW92ZWQpIGNvbnRpbnVlOwogICAgICAgIC8vIEFmdGVyIG1vdmUsIGV4cGVjdGltYXggY2hhbmNlIG5vZGUKICAgICAgICBjb25zdCB2YWwgPSBleHBlY3RpbWF4KG5iLCBkZXB0aCAtIDEsIHRydWUpOwogICAgICAgIGlmICh2YWwgPiBiZXN0KSBiZXN0ID0gdmFsOwogICAgICB9CiAgICAgIGlmIChiZXN0ID09PSAtSW5maW5pdHkpIHJldHVybiBoZXVyaXN0aWMoYm9hcmQpOyAvLyBubyB2YWxpZCBtb3ZlcwogICAgICByZXR1cm4gYmVzdDsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGZpbmRCZXN0TW92ZShib2FyZCwgZGVwdGgpIHsKICAgIGxldCBiZXN0TW92ZSA9IG51bGw7CiAgICBsZXQgYmVzdFNjb3JlID0gLUluZmluaXR5OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNT1ZFUy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCBkaXIgPSBNT1ZFU1tpXTsKICAgICAgY29uc3QgeyBib2FyZDogbmIsIG1vdmVkIH0gPSBtb3ZlT24oYm9hcmQsIGRpcik7CiAgICAgIGlmICghbW92ZWQpIGNvbnRpbnVlOwogICAgICBjb25zdCBzYyA9IGV4cGVjdGltYXgobmIsIGRlcHRoIC0gMSwgdHJ1ZSk7CiAgICAgIGlmIChzYyA+IGJlc3RTY29yZSkgewogICAgICAgIGJlc3RTY29yZSA9IHNjOwogICAgICAgIGJlc3RNb3ZlID0gZGlyOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYmVzdE1vdmU7CiAgfQoKICAvKiAtLS0tLS0tLS0tIEtleWJvYXJkIGRpc3BhdGNoICh0cmlnZ2VyIGludGVybmFsIG1vdmUgaGFuZGxlcikgLS0tLS0tLS0tLSAqLwogIGZ1bmN0aW9uIHNlbmRLZXkoZGlyKSB7CiAgICBjb25zdCBrZXlNYXAgPSB7CiAgICAgIGxlZnQ6ICJBcnJvd0xlZnQiLAogICAgICByaWdodDogIkFycm93UmlnaHQiLAogICAgICB1cDogIkFycm93VXAiLAogICAgICBkb3duOiAiQXJyb3dEb3duIgogICAgfTsKICAgIGNvbnN0IGtleSA9IGtleU1hcFtkaXJdOwogICAgaWYgKCFrZXkpIHJldHVybjsKICAgIC8vIERpc3BhdGNoIEtleWJvYXJkRXZlbnQgKGtleWRvd24pIG9uIGRvY3VtZW50CiAgICBjb25zdCBldiA9IG5ldyBLZXlib2FyZEV2ZW50KCJrZXlkb3duIiwgewogICAgICBrZXk6IGtleSwKICAgICAgY29kZToga2V5LAogICAgICBrZXlDb2RlOiBrZXkgPT09ICJBcnJvd0xlZnQiID8gMzcgOiBrZXkgPT09ICJBcnJvd1VwIiA/IDM4IDoga2V5ID09PSAiQXJyb3dSaWdodCIgPyAzOSA6IDQwLAogICAgICB3aGljaDoga2V5ID09PSAiQXJyb3dMZWZ0IiA/IDM3IDoga2V5ID09PSAiQXJyb3dVcCIgPyAzOCA6IGtleSA9PT0gIkFycm93UmlnaHQiID8gMzkgOiA0MCwKICAgICAgYnViYmxlczogdHJ1ZSwKICAgICAgY2FuY2VsYWJsZTogdHJ1ZQogICAgfSk7CiAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KGV2KTsKICB9CgogIC8qIC0tLS0tLS0tLS0gVUk6IEF1dG8gUGxheSBCdXR0b24gLS0tLS0tLS0tLSAqLwogIGZ1bmN0aW9uIG1ha2VCdXR0b24oKSB7CiAgICBjb25zdCBleGlzdGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0ZC1hdXRvLXBsYXktYnRuIik7CiAgICBpZiAoZXhpc3RpbmcpIHJldHVybiBleGlzdGluZzsKICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogIGJ0bi5pZCA9ICJ0ZC1hdXRvLXBsYXktYnRuIjsKICBidG4uaW5uZXJUZXh0ID0gIkFVVE8gUExBWSI7CiAgYnRuLnN0eWxlLnBvc2l0aW9uID0gImZpeGVkIjsKICBidG4uc3R5bGUucmlnaHQgPSAiMTZweCI7CiAgYnRuLnN0eWxlLnRvcCA9ICI4MHB4IjsKICBidG4uc3R5bGUuekluZGV4ID0gOTk5OTk5OwogIGJ0bi5zdHlsZS5wYWRkaW5nID0gIjEwcHggMTRweCI7CiAgYnRuLnN0eWxlLmJhY2tncm91bmQgPSAiI2ZmNmI2YiI7CiAgYnRuLnN0eWxlLmNvbG9yID0gIiNmZmYiOwogIGJ0bi5zdHlsZS5ib3JkZXIgPSAibm9uZSI7CiAgYnRuLnN0eWxlLmJvcmRlclJhZGl1cyA9ICI2cHgiOwogIGJ0bi5zdHlsZS5ib3hTaGFkb3cgPSAiMCAzcHggMTBweCByZ2JhKDAsMCwwLDAuMikiOwogIGJ0bi5zdHlsZS5jdXJzb3IgPSAicG9pbnRlciI7CiAgYnRuLnN0eWxlLmZvbnRXZWlnaHQgPSAiNzAwIjsKICBidG4uc3R5bGUuZm9udFNpemUgPSAiMTRweCI7CiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChidG4pOwogIHJldHVybiBidG47CiAgfQoKICBsZXQgYXV0b0ludGVydmFsID0gbnVsbDsKICBmdW5jdGlvbiBzdGFydEF1dG8oKSB7CiAgICBpZiAoYXV0b0ludGVydmFsKSByZXR1cm47CiAgICBsZXQgbGFzdERpciA9IG51bGw7CiAgICBhdXRvSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgYm9hcmQgPSByZWFkQm9hcmRGcm9tRE9NKCk7CiAgICAgICAgLy8gY2hlY2sgZ2FtZSBvdmVyIG9yIGVtcHR5IGJvYXJkCiAgICAgICAgY29uc3QgZW1wdCA9IGdldEVtcHR5Q2VsbHMoYm9hcmQpOwogICAgICAgIGNvbnN0IG5vbkVtcHR5ID0gYm9hcmQuZmxhdCgpLmZpbHRlcihCb29sZWFuKTsKICAgICAgICBpZiAoIW5vbkVtcHR5Lmxlbmd0aCkgewogICAgICAgICAgLy8gbm90IHN0YXJ0ZWQsIHdhaXQKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gZmluZCBiZXN0IG1vdmUKICAgICAgICBjb25zdCBiZXN0ID0gZmluZEJlc3RNb3ZlKGJvYXJkLCBTRUFSQ0hfREVQVEgpOwogICAgICAgIGlmICghYmVzdCkgewogICAgICAgICAgLy8gbm8gbW92ZSAtPiBzdG9wCiAgICAgICAgICBjb25zb2xlLmxvZygiTm8gdmFsaWQgbW92ZSDigJQgc3RvcHBpbmcgYXV0by4iKTsKICAgICAgICAgIHN0b3BBdXRvKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIGF2b2lkIHJlcGVhdGluZyBzYW1lIGludmFsaWQgbW92ZTogaWYgc2FtZSBhcyBsYXN0IGFuZCBkaWRuJ3QgY2hhbmdlIGJvYXJkLCBjb25zaWRlciB0cnlpbmcgYWx0ZXJuYXRpdmUKICAgICAgICAvLyBidXQgaGVyZSB3ZSBqdXN0IHNlbmQga2V5CiAgICAgICAgc2VuZEtleShiZXN0KTsKICAgICAgICBsYXN0RGlyID0gYmVzdDsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkF1dG8gZXJyb3I6IiwgZSk7CiAgICAgIH0KICAgIH0sIE1PVkVfSU5URVJWQUxfTVMpOwogICAgY29uc29sZS5sb2coIiVjVEQgQVVUTyBQTEFZIFNUQVJURUQiLCAiY29sb3I6bGltZTtmb250LXdlaWdodDo3MDAiKTsKICB9CgogIGZ1bmN0aW9uIHN0b3BBdXRvKCkgewogICAgaWYgKGF1dG9JbnRlcnZhbCkgewogICAgICBjbGVhckludGVydmFsKGF1dG9JbnRlcnZhbCk7CiAgICAgIGF1dG9JbnRlcnZhbCA9IG51bGw7CiAgICAgIGNvbnNvbGUubG9nKCIlY1REIEFVVE8gUExBWSBTVE9QUEVEIiwgImNvbG9yOm9yYW5nZTtmb250LXdlaWdodDo3MDAiKTsKICAgIH0KICB9CgogIC8vIGNyZWF0ZSBidXR0b24gYW5kIHdpcmUgZXZlbnRzCiAgY29uc3QgYnRuID0gbWFrZUJ1dHRvbigpOwogIGxldCBydW5uaW5nID0gZmFsc2U7CiAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgaWYgKCFydW5uaW5nKSB7CiAgICAgIC8vIGNoZWNrIGdhbWUgc3RhcnRlZAogICAgICBjb25zdCBib2FyZCA9IHJlYWRCb2FyZEZyb21ET00oKTsKICAgICAgY29uc3Qgbm9uRW1wdHkgPSBib2FyZC5mbGF0KCkuZmlsdGVyKEJvb2xlYW4pOwogICAgICBpZiAoIW5vbkVtcHR5Lmxlbmd0aCkgewogICAgICAgIGFsZXJ0KCJIw6N5IGLhuqVtIELhuq90IMSR4bqndSAoU3RhcnQpIHRyb25nIGdhbWUgdHLGsOG7m2Mga2hpIGLhuq10IEFVVE8uIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHN0YXJ0QXV0bygpOwogICAgICBydW5uaW5nID0gdHJ1ZTsKICAgICAgYnRuLmlubmVyVGV4dCA9ICJTVE9QIEFVVE8iOwogICAgICBidG4uc3R5bGUuYmFja2dyb3VuZCA9ICIjNGNhZjUwIjsKICAgIH0gZWxzZSB7CiAgICAgIHN0b3BBdXRvKCk7CgogICAgICBydW5uaW5nID0gZmFsc2U7CiAgICAgIGJ0bi5pbm5lclRleHQgPSAiQVVUTyBQTEFZIjsKICAgICAgYnRuLnN0eWxlLmJhY2tncm91bmQgPSAiI2ZmNmI2YiI7CiAgICB9CiAgfSk7CgogIC8vIGV4cG9zZSBzdG9wIHRvIGNvbnNvbGUKICB3aW5kb3cuVERfU1RPUF9BVVRPID0gc3RvcEF1dG87CgogIC8vIHNtYWxsIGhlbHBlciB0byBzaG93IHN0YXR1cyBpbiBjb25zb2xlCiAgY29uc29sZS5sb2coIiVjVEQgQXV0byBMb2FkZWQuIENsaWNrIEFVVE8gUExBWSBhZnRlciB5b3UgcHJlc3MgU3RhcnQgaW4gZ2FtZS4iLCAiY29sb3I6bGlnaHRibHVlIik7Cn0pKCk7";
    const decoded = atob(codeB64);
    eval(decoded);
  }catch(e){
    console.error("Loader error:", e);
    alert("Không thể tải config hoặc config không hợp lệ.");
  }
})();